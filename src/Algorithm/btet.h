#include "..\src\MeshViewer\MeshDefinition.h"
#include "scalar_def.h"
#include <Eigen/Core>
namespace CABT
{
    class tet2
    {
    public:
        tet2() 
        { 
            //!!!!!!!!!!!!!!!记得看这样行列顺序是不是有问题
            o2vec2tensor << 0, 0, 0,  0, 0, 1.0 / 2,   0, 0, 1,               0, 1.0 / 2, 0,         0, 1.0 / 2, 1.0 / 2,
                            0, 1, 0,  1.0 / 2, 0, 0,   1.0 / 2, 0, 1.0 / 2,   1.0 / 2, 1.0 / 2, 0,   1, 0, 0;
            o2tensor2vec = tensor3(3, 3, 3);
            o2tensor2vec(0, 0, 0) = 0; o2tensor2vec(0, 0, 1) = 1; o2tensor2vec(0, 0, 2) = 2; o2tensor2vec(0, 1, 0) = 3; o2tensor2vec(0, 1, 1) = 4;
            o2tensor2vec(0, 2, 0) = 5; o2tensor2vec(1, 0, 0) = 6; o2tensor2vec(1, 0, 1) = 7; o2tensor2vec(1, 1, 0) = 8; o2tensor2vec(2, 0, 0) = 9;

            o3vec2tensor << 0, 0, 0,              0, 0, 1.0 / 3,        0, 0, 2.0 / 3,         0, 0, 1,              0, 1.0 / 3, 0,
                            0, 1.0 / 3, 1.0 / 3,  0, 1.0 / 3, 2.0 / 3,  0, 2.0 / 3, 0,         0, 2.0 / 3, 1.0 / 3,  0, 1, 0,          
                            1.0 / 3, 0, 0,        1.0 / 3, 0, 1.0 / 3,  1.0 / 3, 0, 2.0 / 3,   1.0 / 3, 1.0 / 3, 0,  1.0 / 3, 1.0 / 3, 1.0 / 3,   
                            1.0 / 3, 2.0 / 3, 0,  2.0 / 3, 0, 0,         2.0 / 3, 0, 1.0 / 3,  2.0 / 3, 1.0 / 3, 0,  1, 0, 0;
            o3tensor2vec = tensor3(4, 4, 4);
            o3tensor2vec(0, 0, 0) = 0; o3tensor2vec(0, 0, 1) = 1; o3tensor2vec(0, 0, 2) = 2; o3tensor2vec(0, 0, 3) = 3; o3tensor2vec(0, 1, 0) = 4;
            o3tensor2vec(0, 1, 1) = 5; o3tensor2vec(0, 1, 2) = 6; o3tensor2vec(0, 2, 0) = 7; o3tensor2vec(0, 2, 1) = 8; o3tensor2vec(0, 3, 0) = 9;
            o3tensor2vec(1, 0, 0) = 10; o3tensor2vec(1, 0, 1) = 11; o3tensor2vec(1, 0, 2) = 12; o3tensor2vec(1, 1, 0) = 13; o3tensor2vec(1, 1, 1) = 14;
            o3tensor2vec(1, 2, 0) = 15; o3tensor2vec(2, 0, 0) = 16; o3tensor2vec(2, 0, 1) = 17; o3tensor2vec(2, 1, 0) = 18; o3tensor2vec(3, 0, 0) = 19;

            transform<< 1, -(5.0 / 6), 1.0 / 3, 0, -(5.0 / 6), 1.0 / 3, 0, 1.0 / 3, 0, 0, -(5.0 / 6), 1.0 / 3, 0, 1.0 / 3, 0, 0, 1.0 / 3, 0, 0, 0,
                // Row 2
                0, 3, -(3.0 / 2), 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0, 0, 0, 0,
                // Row 3
                0, -(3.0 / 2), 3, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0, 0, 0, 0,
                // Row 4
                0, 1.0 / 3, -(5.0 / 6), 1, 0, 1.0 / 3, -(5.0 / 6), 0, 1.0 / 3, 0, 0, 1.0 / 3, -(5.0 / 6), 0, 1.0 / 3, 0, 0, 1.0 / 3, 0, 0,
                // Row 5
                0, 0, 0, 0, 3, -(3.0 / 4), 0, -(3.0 / 2), 0, 0, 0, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0, 0,
                // Row 6
                0, 0, 0, 0, 0, 9.0 / 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                // Row 7
                0, 0, 0, 0, 0, -(3.0 / 4), 3, 0, -(3.0 / 2), 0, 0, 0, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0,
                // Row 8
                0, 0, 0, 0, -(3.0 / 2), -(3.0 / 4), 0, 3, 0, 0, 0, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0, 0,
                // Row 9
                0, 0, 0, 0, 0, -(3.0 / 4), -(3.0 / 2), 0, 3, 0, 0, 0, 0, 0, -(3.0 / 4), 0, 0, 0, 0, 0,
                // Row 10
                0, 0, 0, 0, 1.0 / 3, 1.0 / 3, 1.0 / 3, -(5.0 / 6), -(5.0 / 6), 1, 0, 0, 0, 1.0 / 3, 1.0 / 3, -(5.0 / 6), 0, 0, 1.0 / 3, 0,
                // Row 11
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, -(3.0 / 4), 0, -(3.0 / 4), 0, 0, -(3.0 / 2), 0, 0, 0,
                // Row 12
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9.0 / 2, 0, 0, 0, 0, 0, 0, 0, 0,
                // Row 13
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -(3.0 / 4), 3, 0, -(3.0 / 4), 0, 0, -(3.0 / 2), 0, 0,
                // Row 14
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9.0 / 2, 0, 0, 0, 0, 0, 0,
                // Row 15
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9.0 / 2, 0, 0, 0, 0, 0,
                // Row 16
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -(3.0 / 4), -(3.0 / 4), 3, 0, 0, -(3.0 / 2), 0,
                // Row 17
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -(3.0 / 2), -(3.0 / 4), 0, -(3.0 / 4), 0, 0, 3, 0, 0, 0,
                // Row 18
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -(3.0 / 4), -(3.0 / 2), 0, -(3.0 / 4), 0, 0, 3, 0, 0,
                // Row 19
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -(3.0 / 4), -(3.0 / 4), -(3.0 / 2), 0, 0, 3, 0,
                // Row 20
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.0 / 3, 1.0 / 3, 1.0 / 3, 1.0 / 3, 1.0 / 3, 1.0 / 3, -(5.0 / 6), -(5.0 / 6), -(5.0 / 6), 1;
        }
        ~tet2() { }

    public:
        mat3_20 o2vec2tensor;
        tensor3 o2tensor2vec;
        mat3_20 o3vec2tensor;
        tensor3 o3tensor2vec;
        mat3_10 control_val;
        mat3_10 control_dir;
        mat20_20 transform;
        void calc_sampling_jacobi_det(scalar t, mat20_4 &det);
        void calc_bezier_cof(mat20_4& cof);
    };
}